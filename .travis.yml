language: cpp

os:
  - linux

compiler:
  - clang
  - gcc

notifications:
  irc:
    channels:
      - "irc.freenode.net#nupic-hackers"
  webhooks: http://issues.numenta.org:8081/travis

before_install:
  - "if [ $CC = 'gcc' ]; then export CXX=g++; fi"
  - "if [ $CC = 'clang' ]; then export CXX=clang++; fi"
  # https://github.com/eddyxu/cpp-coveralls
  - "sudo pip install cpp-coveralls"

install:
  - "mkdir -p $TRAVIS_BUILD_DIR/build/scripts"
  - "cd $TRAVIS_BUILD_DIR/build/scripts"
  - "cmake $TRAVIS_BUILD_DIR/src -DNTA_COV_ENABLED=ON"
  - "sudo find / -name libgcov.a"

script:
  - "cd $TRAVIS_BUILD_DIR/build/scripts"
  - "make -j3"
  # legacy binary tests
  - "make tests_htm"
  # (not quite everything, really)
  - "make tests_everything"
  # unit tests
  - "make tests_unit"
after_success:
  - "cd $TRAVIS_BUILD_DIR"
  # send test coverage report to http://coveralls.io
  - "coveralls --exclude external --exclude doc --exclude src/test"
